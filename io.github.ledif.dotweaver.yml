app-id: io.github.ledif.dotweaver
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: dotweaver
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --filesystem=~/.config/chezmoi:rw
  - --filesystem=~/.local/share/chezmoi:rw
  - --filesystem=~/.config/dotweaver:create
  - --talk-name=org.freedesktop.Notifications
  - --system-talk-name=org.freedesktop.login1

build-options:
  env:
    - GOBIN=/app/bin
    - GOROOT=/usr/lib/sdk/golang
    - CGO_ENABLED=0

modules:
  - name: chezmoi
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
    build-commands:
      - go install -mod=vendor .

    sources:
      - type: git
        url: https://github.com/twpayne/chezmoi
        tag: v2.64.0
        commit: 9b1def1eff7c581272ffeb7f707e7af80ec434b1
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          is-important: true

      - go.mod.yml

    modules:
      - name: dotweaver
        buildsystem: cmake-ninja
        config-opts:
          - -DCMAKE_BUILD_TYPE=RelWithDebInfo
        sources:
          - type: dir
            path: .
